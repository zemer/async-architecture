# async-architecture
Awesome Task Exchange System (aTES) для UberPopug Inc

[Схема](https://lucid.app/lucidchart/beeab6f0-1597-4557-b93b-a68c2187de18/edit?viewport_loc=-247%2C133%2C3072%2C1545%2C0_0&invitationId=inv_cd589129-252a-4fe1-982c-2dddee725cf4)

## Сервисы:
* Auth service
* Tasks service
* Accaunting service

### Auth service
Сервис аутентификации и авторизации. Отвечает за пользователей, вход и регистрацию, устанавливает cookie в ответ на корректный логин и пароль.

### Tasks service
Сервис тасков. Отвечает за список тасков, их создание, случайное назначение.

### Accaunting service
Сервис аккаунтинга и аналитики. Отвечает за счета пользователей и генерацию отчетов.

### Mail service
Отправка отчетов по почте.

## Коммуникации между сервисами
| Направление | Название | Тип | Описание | Поля | Ответ | Если сломается сеть или БД |
| - | - | - | - | - | - | - |
| [Tasks service] -> [Accaunting service] | Update bill | ASYNC | Обновление счета пользователя после назначения или окончания задачи | taskID, cost | | Формировать очередь на обновление данных и гарантированную доставку |
| [Tasks service] -> [Accaunting service] | Get task cost | SYNC | Запрос расценки задачи при ее создании | taskID | cost | Задача не получит расценку, такой задаче можно поставить статус Draft и не раздавать ее. Опять же, нужно с некой периодичностью опрашивать сервис расчетов |
| [Accaunting service] -> [Tasks service] | Get tasks | SYNC | Запрос тасков для формирования отчетов с необязательным фильтром по пользователю | [users] | tasks[] | Пользователи не получат отчет. |
| [Accaunting service] -> [Mail service] | Send report | ASYNC | Отправка отчета пользователям по почте | task, user, sum |  | Пользователь не получит отчет за день. Можно складывать отчеты в БД и отправлять по досупности сервиса. |

## Спорные моменты
* Как хранить данные - в единое БД или в разных.
* Сразу хочется использовать message brokers, но за этим я и пришел.
